<?php
function i18n_init(): void
{
    if (session_status() === PHP_SESSION_NONE) {
        session_start();
    }
    $allowed = ['en', 'ne'];
    if (isset($_GET['lang']) && in_array($_GET['lang'], $allowed, true)) {
        $_SESSION['lang'] = $_GET['lang'];
    }
    if (!isset($_SESSION['lang']) || !in_array($_SESSION['lang'], $allowed, true)) {
        $_SESSION['lang'] = 'en';
    }
}

i18n_init();

function i18n_lang(): string
{
    return $_SESSION['lang'] ?? 'en';
}

function i18n_t(string $key, string $fallback = ''): string
{
    $translations = i18n_dict();
    $lang = i18n_lang();
    if (isset($translations[$lang][$key])) {
        return $translations[$lang][$key];
    }
    return $fallback !== '' ? $fallback : $key;
}

function i18n_dict(): array
{
    return [
        'en' => [
            'nav.home' => 'Home',
            'nav.tickets' => 'My Tickets',
            'nav.messages' => 'Messages',
            'nav.contacts' => 'Contacts',
            'nav.logout' => 'Logout',
            'nav.documents' => 'Documents Info',
            'nav.lang.en' => 'EN',
            'nav.lang.ne' => 'ने',
            'home.quick_links' => 'Quick Links',
            'home.tickets' => 'Tickets',
            'home.tickets.sub' => 'Open or track your tickets',
            'home.documents' => 'Documents Info',
            'home.documents.sub' => 'Processes, documents, office timings',
            'home.contacts' => 'Contacts',
            'home.contacts.sub' => 'Officials & office info',
            'home.message' => 'Message',
            'home.message.sub' => 'Send queries to officials',
            'home.new_ticket' => 'New Ticket',
            'home.new_ticket.sub' => 'Create a new request',
            'home.my_messages' => 'My Messages',
            'home.my_messages.sub' => 'Your sent messages',
            'mymessages.title' => 'My Messages',
            'mymessages.empty' => 'No messages sent yet.',
            'mymessages.recipient' => 'Recipient',
            'mymessages.recipient_email' => 'Recipient Email',
            'mymessages.your_name' => 'Your Name',
            'mymessages.your_email' => 'Your Email',
            'mymessages.subject' => 'Subject',
            'mymessages.message' => 'Message',
            'mymessages.attachment' => 'Attachment',
            'mymessages.sent' => 'Sent',
            'mymessages.none' => 'None',
            'message.title' => 'Message Officials',
            'message.subtitle' => 'Send your queries or problems directly to municipal officials.',
            'message.sendto' => 'Send to',
            'message.select' => 'Select recipient',
            'message.your_name' => 'Your name',
            'message.your_email' => 'Your email',
            'message.subject' => 'Subject',
            'message.message' => 'Message',
            'message.attachment' => 'Attachment (optional)',
            'message.attachment_help' => 'Up to 10MB. Allowed: PDF, images, Office docs, CSV, TXT.',
            'message.submit' => 'Send Message',
            'mytickets.breadcrumb.dashboard' => 'Dashboard',
            'mytickets.breadcrumb.title' => 'My tickets',
            'mytickets.empty' => 'No tickets yet. Tap New ticket in the menu to create your first request.',
            'mytickets.table.subject' => 'Subject',
            'mytickets.table.requester' => 'Requester',
            'mytickets.table.team' => 'Team',
            'mytickets.table.agent' => 'Agent',
            'mytickets.table.status' => 'Status',
            'mytickets.table.requested' => 'Requested',
            'mytickets.table.action' => 'Action',
            'mytickets.table.view' => 'View',
            'tickets.menu.title' => 'Tickets',
            'tickets.open_new' => 'Open New Ticket',
            'tickets.pending' => 'My Pending Tickets',
            'tickets.my' => 'My Tickets',
            'tickets.dashboard' => 'Dashboard',
            'tickets.open' => 'Open',
            'tickets.solved' => 'Solved',
            'tickets.closed' => 'Closed',
            'tickets.unassigned' => 'Unassigned',
            'docs.title' => 'Documents Info',
            'docs.subtitle' => 'Find municipality processes, the documents required to start them, and the office timings.',
            'docs.office_hours' => 'General Office Hours',
            'docs.required_documents' => 'Required Documents',
            'docs.office_timing' => 'Office Timing',
            'docs.window_number' => 'Window Number',
            'docs.process' => 'Process',
            'docs.update_hours' => 'Update office hours',
            'docs.add_process' => 'Add new process',
            'docs.process_title' => 'Process title',
            'docs.process_summary' => 'Short summary',
            'docs.process_documents' => 'Required documents (one per line)',
            'docs.process_timing' => 'Office timing',
            'docs.process_window' => 'Window number',
            'docs.save' => 'Save',
            'docs.delete' => 'Delete',
            'docs.add' => 'Add Process',
            'contacts.title' => 'Contacts',
            'contacts.subtitle' => 'Officials and office contact points for Shuklagandaki Municipality.',
            'contacts.photo' => 'Photo',
            'contacts.name' => 'Name',
            'contacts.role' => 'Role',
            'contacts.email' => 'Email',
            'contacts.phone' => 'Phone',
            'contacts.update' => 'Update',
            'contacts.delete' => 'Delete',
            'contacts.add' => 'Add Contact',
            'contacts.photos_loaded' => 'Photos loaded from img/ and img/contacts/.',
            'login.brand.kicker' => 'Government of Nepal',
            'login.brand.name' => 'Shuklagandaki Municipality',
            'login.brand.sub' => 'Citizen Service Portal',
            'login.lead' => 'Sign in to request services, check the status of your applications, and get updates from your ward office.',
            'login.bullet1' => 'Use the email you provided when registering for municipal services.',
            'login.bullet2' => 'Keep your password safe and avoid using shared or public devices.',
            'login.bullet3' => 'If you face issues signing in, reset your password or contact your ward office.',
            'login.support' => 'For urgent support (lost access or suspected misuse), reset your password first and then notify the ward helpdesk.',
            'login.header.kicker' => 'Secure Access',
            'login.header.title' => 'Login',
            'login.header.subtitle' => 'Sign in with the email you used to register.',
            'login.email.label' => 'Email',
            'login.email.placeholder' => 'name@example.com',
            'login.password.label' => 'Password',
            'login.password.placeholder' => 'Enter your password',
            'login.password.helper' => 'Minimum 8 characters; keep your credentials confidential.',
            'login.forgot' => 'Forgot password?',
            'login.remember' => 'Keep me signed in',
            'login.submit' => 'Sign in',
            'login.create' => 'Create a new account',
            'login.status' => 'By signing in you agree to receive updates about your requests and to keep your account secure.'
        ],
        'ne' => [
            'nav.home' => 'गृह',
            'nav.tickets' => 'मेरो टिकटहरू',
            'nav.messages' => 'सन्देशहरू',
            'nav.contacts' => 'सम्पर्क',
            'nav.logout' => 'लगआउट',
            'nav.documents' => 'कागजात जानकारी',
            'nav.lang.en' => 'EN',
            'nav.lang.ne' => 'ने',
            'home.quick_links' => 'छिटो लिङ्कहरू',
            'home.tickets' => 'टिकटहरू',
            'home.tickets.sub' => 'टिकट खोल्नुहोस् वा ट्र्याक गर्नुहोस्',
            'home.documents' => 'कागजात जानकारी',
            'home.documents.sub' => 'प्रक्रिया, कागजात, कार्यालय समय',
            'home.contacts' => 'सम्पर्क',
            'home.contacts.sub' => 'अधिकारी तथा कार्यालय जानकारी',
            'home.message' => 'सन्देश',
            'home.message.sub' => 'अधिकारीलाई जिज्ञासा पठाउनुहोस्',
            'home.new_ticket' => 'नयाँ टिकट',
            'home.new_ticket.sub' => 'नयाँ अनुरोध बनाउनुहोस्',
            'home.my_messages' => 'मेरो सन्देशहरू',
            'home.my_messages.sub' => 'तपाईंका पठाइएका सन्देश',
            'mymessages.title' => 'मेरो सन्देशहरू',
            'mymessages.empty' => 'अहिलेसम्म कुनै सन्देश पठाइएको छैन।',
            'mymessages.recipient' => 'प्राप्तकर्ता',
            'mymessages.recipient_email' => 'प्राप्तकर्ताको इमेल',
            'mymessages.your_name' => 'तपाईंको नाम',
            'mymessages.your_email' => 'तपाईंको इमेल',
            'mymessages.subject' => 'विषय',
            'mymessages.message' => 'सन्देश',
            'mymessages.attachment' => 'संलग्न फाइल',
            'mymessages.sent' => 'पठाइएको समय',
            'mymessages.none' => 'छैन',
            'message.title' => 'अधिकारीहरूलाई सन्देश',
            'message.subtitle' => 'आफ्ना जिज्ञासा वा समस्या सिधै नगरपालिका अधिकारीहरूलाई पठाउनुहोस्।',
            'message.sendto' => 'पठाउने',
            'message.select' => 'प्राप्तकर्ता छान्नुहोस्',
            'message.your_name' => 'तपाईंको नाम',
            'message.your_email' => 'तपाईंको इमेल',
            'message.subject' => 'विषय',
            'message.message' => 'सन्देश',
            'message.attachment' => 'संलग्न फाइल (ऐच्छिक)',
            'message.attachment_help' => '१०MB सम्म। अनुमति: PDF, तस्बिर, Office कागजात, CSV, TXT।',
            'message.submit' => 'सन्देश पठाउनुहोस्',
            'mytickets.breadcrumb.dashboard' => 'ड्यासबोर्ड',
            'mytickets.breadcrumb.title' => 'मेरो टिकटहरू',
            'mytickets.empty' => 'अहिलेसम्म टिकट छैन। पहिलो अनुरोध बनाउन मेनुमा नयाँ टिकट थिच्नुहोस्।',
            'mytickets.table.subject' => 'विषय',
            'mytickets.table.requester' => 'अनुरोधकर्ता',
            'mytickets.table.team' => 'टिम',
            'mytickets.table.agent' => 'एजेन्ट',
            'mytickets.table.status' => 'स्थिति',
            'mytickets.table.requested' => 'अनुरोध समय',
            'mytickets.table.action' => 'कार्रवाई',
            'mytickets.table.view' => 'हेर्नुहोस्',
            'tickets.menu.title' => 'टिकटहरू',
            'tickets.open_new' => 'नयाँ टिकट खोल्नुहोस्',
            'tickets.pending' => 'मेरो पेन्डिङ टिकट',
            'tickets.my' => 'मेरो टिकटहरू',
            'tickets.dashboard' => 'ड्यासबोर्ड',
            'tickets.open' => 'खुला',
            'tickets.solved' => 'समाधान भएका',
            'tickets.closed' => 'बन्द',
            'tickets.unassigned' => 'नबाँडिएका',
            'docs.title' => 'कागजात जानकारी',
            'docs.subtitle' => 'नगरपालिकाका प्रक्रियाहरू, सुरु गर्न आवश्यक कागजात र कार्यालय समय हेर्नुहोस्।',
            'docs.office_hours' => 'सामान्य कार्यालय समय',
            'docs.required_documents' => 'आवश्यक कागजातहरू',
            'docs.office_timing' => 'कार्यालय समय',
            'docs.window_number' => 'विन्डो नम्बर',
            'docs.process' => 'प्रक्रिया',
            'docs.update_hours' => 'कार्यालय समय अद्यावधिक',
            'docs.add_process' => 'नयाँ प्रक्रिया थप्नुहोस्',
            'docs.process_title' => 'प्रक्रिया शीर्षक',
            'docs.process_summary' => 'छोटो विवरण',
            'docs.process_documents' => 'आवश्यक कागजातहरू (प्रत्येक लाइनमा एक)',
            'docs.process_timing' => 'कार्यालय समय',
            'docs.process_window' => 'विन्डो नम्बर',
            'docs.save' => 'सेभ',
            'docs.delete' => 'मेट्नुहोस्',
            'docs.add' => 'प्रक्रिया थप्नुहोस्',
            'contacts.title' => 'सम्पर्क',
            'contacts.subtitle' => 'शुक्लागण्डकी नगरपालिकाका अधिकारी तथा कार्यालय सम्पर्क विवरण।',
            'contacts.photo' => 'फोटो',
            'contacts.name' => 'नाम',
            'contacts.role' => 'पद',
            'contacts.email' => 'इमेल',
            'contacts.phone' => 'फोन',
            'contacts.update' => 'अद्यावधिक',
            'contacts.delete' => 'हटाउनुहोस्',
            'contacts.add' => 'सम्पर्क थप्नुहोस्',
            'contacts.photos_loaded' => 'तस्बिरहरू img/ र img/contacts/ बाट लोड भएका छन्।',
            'login.brand.kicker' => 'नेपाल सरकार',
            'login.brand.name' => 'शुक्लागण्डकी नगरपालिका',
            'login.brand.sub' => 'नागरिक सेवा पोर्टल',
            'login.lead' => 'सेवा अनुरोध गर्न, आवेदनको स्थिति हेर्न र वडा कार्यालयबाट अपडेट पाउन साइन इन गर्नुहोस्।',
            'login.bullet1' => 'नगरपालिकामा दर्ता गर्दा प्रयोग गरिएको इमेल प्रयोग गर्नुहोस्।',
            'login.bullet2' => 'पासवर्ड सुरक्षित राख्नुहोस् र साझा वा सार्वजनिक उपकरण प्रयोग नगर्नुहोस्।',
            'login.bullet3' => 'साइन इनमा समस्या आएमा पासवर्ड रिसेट गर्नुहोस् वा वडा कार्यालय सम्पर्क गर्नुहोस्।',
            'login.support' => 'आपतकालीन सहयोग (प्रवेश हरायो वा दुरुपयोग शङ्का) चाहिँदा पासवर्ड रिसेट गरी वडा हेल्पडेस्कलाई सूचित गर्नुहोस्।',
            'login.header.kicker' => 'सुरक्षित पहुँच',
            'login.header.title' => 'लगइन',
            'login.header.subtitle' => 'दर्ता गर्दा प्रयोग गरिएको इमेल प्रयोग गरी साइन इन गर्नुहोस्।',
            'login.email.label' => 'Email',
            'login.email.placeholder' => 'name@example.com',
            'login.password.label' => 'पासवर्ड',
            'login.password.placeholder' => 'पासवर्ड प्रविष्ट गर्नुहोस्',
            'login.password.helper' => 'कम्तीमा ८ क्यारेक्टर; आफ्नो प्रमाणीकरण सुरक्षित राख्नुहोस्।',
            'login.forgot' => 'पासवर्ड बिर्सनुभयो?',
            'login.remember' => 'लगइन याद राख्नुहोस्',
            'login.submit' => 'साइन इन गर्नुहोस्',
            'login.create' => 'नयाँ खाता बनाउनुहोस्',
            'login.status' => 'साइन इन गर्दा तपाईं अनुरोध सम्बन्धी अपडेट पाउन र आफ्नो खाता सुरक्षित राख्न सहमत हुनुहुन्छ।'
        ]
    ];
}
